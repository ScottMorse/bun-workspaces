name: Test Given Bun version
description: Test the given Bun version passed as an input

inputs:
  bun_version:
    description: The Bun version to test
    required: true

runs:
  using: composite
  steps:
    - name: Install Bun ${{ inputs.bun_version }}
      id: install-bun
      shell: bash
      run: |
        bun_version=${{ inputs.bun_version }}
        echo "Installing Bun version: $bun_version"
        export BUN_INSTALL="$HOME/.bun"
        curl -fsSL https://bun.com/install | bash -s "bun-v$bun_version"
        echo "$HOME/.bun/bin:$PATH" >> $GITHUB_PATH
        echo "Bun version: $(bun --version)"

    - name: Install Dependencies
      id: install-deps
      shell: bash
      run: |
        bun install --frozen-lockfile

    - name: Run Tests
      id: run-tests
      shell: bash
      run: |
        echo "Bun version: $(bun --version)"
        bun bw test --reporter=junit --reporter-outfile=../../junit.xml
        if grep -q "<skipped" junit.xml; then
          echo "âŒ Skipped tests found. Exiting with error."
          exit 1
        fi

    - name: Run Tests Against Build
      id: run-tests-against-build
      shell: bash
      run: |
        echo "Bun version: $(bun --version)"
        bun bw build:test
